# 消息队列

[消息队列](https://www.zhihu.com/question/54152397?sort=created)

## 为什么使用消息队列?

- 解耦
    + 用消息隔离两个模块，两个模块之间针对消息接口来编程，耦合度降低
    
- 异步
    + 将消息塞入队列后即可返回处理其他事件

- 削峰
    + 流控
    + 经济考虑，当qps很高时，可以分批处理，不需要一次处理很多消息
    

## 各种消息队列产品的比较

|  特性    | ActiveMq  | RabbitMq  |  RocketMQ    | kafka  |
|  :----:    | :----:      |  :----:     | :----:         |  :----:  | 
| 开发语言   | jave |erlang |jave |scale |
| 吞吐量   | 万级 |万级 |10万级 |10万级 |
| 时效性   | ms |us |ms |ms |
| 可用性   | 高(主从架构) |高(主从架构) |非常高<br>(分布式架构) | 非常高<br>(分布式架构) |
| 功能特性 | 成熟的产品，在很多公司得到应用;有较多的文档;各种协议支持较好 |基于erlang开发，所以并发能力很强，性能及其好，延时很低;管理界面较丰富 |MQ功能比较完备，扩展性佳 |只支持主要的MQ功能，像一些消息查询，消息回溯等功能没有提供，毕竟是为大数据准备的，在大数据领域应用广 |

- ActiveMQ, 早期使用的比较多，没经过大规模吞吐量场景的验证，社区也不是很活跃，但是现在确实大家用的不对了 ，不推荐。
- RabbitMQ, 开发语言erlang阻止了大量的java工程师去深入研究和掌控它，对公司而言，几乎处于不可控的状态，但是RabbitMQ是开源的，比较稳定的支持，活跃度也高，如不考虑二次开发，<font color=Red>追求性能和稳定性，推荐使用</font>。
- RocketMQ, 开发语言是Java，在阿里内部经受过高并发业务的考验，<font color=Red>稳定性和性能均不错，考虑后期可能二次开发，推荐使用</font>。
- Kafka, 大数据领域的实时计算、日志采集等场景，用Kafka是业内标准的，社区活跃度很高，推荐使用。<font color=Red>大数据领域日志采集等业务推荐使用</font>。

## 消息队列的优点和缺点

- 缺点
    + 系统可用性降低<br>
        一旦MQ宕机，就会对业务造成影响
    + 系统复杂度提高
        1. 消息丢失怎么办？
        2. 重复消息怎么处理？
        3. 如何保证消息传递的顺序性？
    + 一致性问题<br>
        可通过分布式事务解决

## 如何保证消息队列的高可用
集群